{% extends 'base.html' %}
{% load static %}

{% block title %}Accueil | ÉvénementsCo{% endblock %}

{% block content %}
<section class="hero">
    <div class="hero-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
    </div>
    <div class="hero-content">
        <div class="hero-badge">La meilleure façon de découvrir des événements</div>
        <h1>Trouvez et réservez des <span class="highlight">expériences</span> inoubliables</h1>
        <p>Découvrez des concerts, festivals, conférences et bien plus encore. Rejoignez notre communauté d'événements passionnants près de chez vous.</p>
        <div class="hero-buttons">
            <a href="#events-list" class="btn btn-primary"><i class="fas fa-search"></i> Découvrir</a>
            <a href="{% if is_authenticated %}{% url 'create_event' %}{% else %}{% url 'login' %}?next={% url 'create_event' %}{% endif %}" class="btn btn-outline"><i class="fas fa-plus-circle"></i> Créer un événement</a>
        </div>
        <div class="hero-stats">
            <div class="stat">
                <span class="stat-number">500+</span>
                <span class="stat-label">Événements</span>
            </div>
            <div class="stat">
                <span class="stat-number">10k+</span>
                <span class="stat-label">Utilisateurs</span>
            </div>
            <div class="stat">
                <span class="stat-number">50+</span>
                <span class="stat-label">Villes</span>
            </div>
        </div>
    </div>
</section>

<section id="events-list" class="events-container">
    <div class="section-header">
        <h2 class="section-title">Événements à venir</h2>
        <div class="section-subtitle">Découvrez les événements les plus populaires</div>
    </div>

    <div class="events-filter">
        <div class="search-bar">
            <i class="fas fa-search search-icon"></i>
            <input type="text" placeholder="Rechercher un événement..." id="search-input" autocomplete="off">
            <button type="submit"><i class="fas fa-arrow-right"></i> Rechercher</button>
        </div>
        <div class="filter-options">
            <div class="filter-group">
                <i class="fas fa-tag"></i>
                <select id="type-filter">
                    <option value="">Tous les types</option>
                    <option value="concert">Concerts</option>
                    <option value="festival">Festivals</option>
                    <option value="conference">Conférences</option>
                    <option value="workshop">Ateliers</option>
                    <option value="sport">Sports</option>
                </select>
            </div>
            <div class="filter-group">
                <i class="fas fa-calendar-alt"></i>
                <select id="date-filter">
                    <option value="">Toutes les dates</option>
                    <option value="today">Aujourd'hui</option>
                    <option value="tomorrow">Demain</option>
                    <option value="week">Cette semaine</option>
                    <option value="weekend">Ce weekend</option>
                    <option value="month">Ce mois-ci</option>
                </select>
            </div>
            <div class="filter-group">
                <i class="fas fa-map-marker-alt"></i>
                <select id="city-filter">
                    <option value="">Toutes les villes</option>
                    <option value="paris">Paris</option>
                    <option value="lyon">Lyon</option>
                    <option value="marseille">Marseille</option>
                    <option value="bordeaux">Bordeaux</option>
                    <option value="lille">Lille</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Tags de filtres actifs -->
    <div class="filter-tags-container">
        <div class="filter-tags">
            <div class="filter-tag active">Tous <i class="fas fa-times"></i></div>
            <div class="filter-tag">Cette semaine <i class="fas fa-times"></i></div>
            <div class="filter-tag">Concerts <i class="fas fa-times"></i></div>
            <div class="filter-tag">Paris <i class="fas fa-times"></i></div>
        </div>
    </div>

    <!-- Conteneur des événements chargés dynamiquement -->
    <div class="events-grid" id="events-container">
        {% include 'event_manager/partials/event_cards.html' %}
    </div>

    <!-- Pagination ajoutée avec AJAX -->
    <section class="pagination-section" id="pagination-container">
        {% include 'event_manager/partials/pagination.html' %}
    </section>
</section>

<section class="cta-section">
    <div class="cta-content">
        <h2>Vous organisez un événement ?</h2>
        <p>Faites la promotion de votre événement et vendez des billets en quelques clics.</p>
        <a href="{% if is_authenticated %}{% url 'create_event' %}{% else %}{% url 'login' %}?next={% url 'create_event' %}{% endif %}" class="btn btn-primary"><i class="fas fa-plus-circle"></i> Créer un événement</a>
    </div>
    <div class="cta-shapes">
        <div class="cta-shape shape-1"></div>
        <div class="cta-shape shape-2"></div>
    </div>
</section>

<section class="categories-section">
    <div class="section-header">
        <h2 class="section-title">Explorez par catégorie</h2>
        <div class="section-subtitle">Trouvez des événements qui correspondent à vos intérêts</div>
    </div>

    <div class="categories-grid">
        <a href="#" class="category-card" style="background-image: url('https://images.unsplash.com/photo-1501386761578-eac5c94b800a?q=80&w=500')">
            <div class="category-overlay"></div>
            <div class="category-icon"><i class="fas fa-music"></i></div>
            <h3 class="category-title">Musique</h3>
        </a>

        <a href="#" class="category-card" style="background-image: url('https://images.unsplash.com/photo-1475721027785-f74eccf877e2?q=80&w=500')">
            <div class="category-overlay"></div>
            <div class="category-icon"><i class="fas fa-utensils"></i></div>
            <h3 class="category-title">Gastronomie</h3>
        </a>

        <a href="#" class="category-card" style="background-image: url('https://images.unsplash.com/photo-1523580494863-6f3031224c94?q=80&w=500')">
            <div class="category-overlay"></div>
            <div class="category-icon"><i class="fas fa-graduation-cap"></i></div>
            <h3 class="category-title">Formation</h3>
        </a>

        <a href="#" class="category-card" style="background-image: url('https://images.unsplash.com/photo-1540747913346-19e32dc3e97e?q=80&w=500')">
            <div class="category-overlay"></div>
            <div class="category-icon"><i class="fas fa-film"></i></div>
            <h3 class="category-title">Cinéma</h3>
        </a>

        <a href="#" class="category-card" style="background-image: url('https://images.unsplash.com/photo-1526401485004-46910ecc8e51?q=80&w=500')">
            <div class="category-overlay"></div>
            <div class="category-icon"><i class="fas fa-running"></i></div>
            <h3 class="category-title">Sport</h3>
        </a>

        <a href="#" class="category-card" style="background-image: url('https://images.unsplash.com/photo-1507608616759-54f48f0af0ee?q=80&w=500')">
            <div class="category-overlay"></div>
            <div class="category-icon"><i class="fas fa-globe-europe"></i></div>
            <h3 class="category-title">Voyage</h3>
        </a>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<link rel="stylesheet" href="{% static 'css/events.css' %}">
{% endblock %}

{% block extra_js %}
<!-- GSAP pour les animations -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<!-- Script personnalisé pour la barre de recherche -->
<script src="{% static 'js/search.js' %}"></script>

<script>
    // Code pour gérer les likes (simulé pour le frontend)
    function initLikeButtons() {
        document.querySelectorAll('.like-btn').forEach(button => {
            button.addEventListener('click', function() {
                const eventId = this.dataset.eventId;
                const icon = this.querySelector('i');
                const likesCount = this.parentElement.querySelector('.likes-count');

                // Simuler l'alternance de l'icône de like
                if (icon.classList.contains('far')) {
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    icon.classList.add('liked');
                    likesCount.textContent = parseInt(likesCount.textContent) + 1;
                } else {
                    icon.classList.remove('fas');
                    icon.classList.remove('liked');
                    icon.classList.add('far');
                    likesCount.textContent = parseInt(likesCount.textContent) - 1;
                }

                // En production, ceci serait un appel AJAX au backend
                console.log(`Like toggled for event ${eventId}`);
            });
        });
    }
    
    // Initialiser les boutons de like au chargement initial
    initLikeButtons();
    
    // AJAX Pagination
    document.addEventListener('DOMContentLoaded', function() {
        // Gestion des clics sur les liens de pagination
        document.body.addEventListener('click', function(e) {
            const target = e.target;
            const pageLink = target.closest('.page-link');
            
            if (pageLink) {
                e.preventDefault();
                
                // Récupérer le numéro de page
                const page = pageLink.dataset.page;
                
                // Scroll vers le haut de la section d'événements
                document.getElementById('events-list').scrollIntoView({behavior: 'smooth'});
                
                // Charger les événements de cette page
                loadPage(page);
            }
        });
        
        // Fonction pour charger une page d'événements via AJAX
        function loadPage(page) {
            // Afficher un indicateur de chargement
            const eventsContainer = document.getElementById('events-container');
            const paginationContainer = document.getElementById('pagination-container');
            
            eventsContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Chargement...</div>';
            
            // Faire la requête AJAX
            fetch(`/api/events/?page=${page}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Mettre à jour les conteneurs avec les nouvelles données
                        eventsContainer.innerHTML = data.events_html;
                        paginationContainer.innerHTML = data.pagination_html;
                        
                        // Réappliquer les écouteurs d'événements aux nouveaux éléments
                        initLikeButtons();
                    } else {
                        eventsContainer.innerHTML = '<div class="error">Une erreur est survenue lors du chargement des événements.</div>';
                    }
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    eventsContainer.innerHTML = '<div class="error">Une erreur est survenue lors du chargement des événements.</div>';
                });
        }
    });
</script>
{% endblock %}
